(function(){var B=YAHOO.util.Dom,Q=YAHOO.util.Event,O=YAHOO.util.DragDropMgr;var f=Alfresco.util.encodeHTML,am=Alfresco.util.activateLinks,aL=Alfresco.util.combinePaths,o=Alfresco.util.userProfileLink,b=Alfresco.util.siteURL,P=function P(a5,a6){return Alfresco.util.formatDate(Alfresco.util.fromISO8601(a5),a6)},ad=Alfresco.util.relativeTime,G=Alfresco.util.isValueSet;var aW="org.alfresco.share.documentList",aH=aW+".sortAscending",d=aW+".sortField",aa=aW+".showFolders",F=aW+".hideNavBar",U=aW+".simpleView",ab=aW+".viewRendererName",aw=aW+".galleryColumns";if(!String.prototype.startsWith){String.prototype.startsWith=function(a6,a5){a5=a5||0;return this.substr(a5,a6.length)===a6}}Alfresco.DnD=function(a9,a6,a5,a7){Alfresco.DnD.superclass.constructor.call(this,a9,a5,a7);var a8=this.getDragEl();B.setStyle(a8,"opacity",0.67);this.docLib=a6};YAHOO.extend(Alfresco.DnD,YAHOO.util.DDProxy,{_inFlight:false,startDrag:function q(a6,a9){var a5=this.getDragEl();var a8=this.getEl();B.setStyle(a8,"visibility","hidden");var a7=document.createElement("img");a7.src=a8.src;a5.removeChild(a5.firstChild);a5.appendChild(a7);B.setStyle(a5,"border","none")},endDrag:function ak(a7){if(!this._inFlight){var a5=this.getEl();var a6=this.getDragEl();this.animateResult(a6,a5)}},animateResult:function at(a8,a5){B.setStyle(a8,"visibility","");var a6=new YAHOO.util.Motion(a8,{points:{to:B.getXY(a5)}},0.2,YAHOO.util.Easing.easeOut);var a7=a8.id;var a9=this.id;a6.onComplete.subscribe(function(){B.setStyle(a7,"visibility","hidden");B.setStyle(a9,"visibility","")});a6.animate()},onDragDrop:function u(ba,a7){var a5=B.get(a7);if(O.interactionInfo.drop.length>0){if(B.isAncestor(this.docLib.widgets.dataTable.getContainerEl(),a5)){var a6=this.docLib.widgets.dataTable.getRecord(B.get(a7)),bb=a6.getData();if(bb.node.isContainer){this._inFlight=true;var bd;if(bb.node.isLink){bd=new Alfresco.util.NodeRef(bb.node.linkedNode.nodeRef)}else{bd=new Alfresco.util.NodeRef(bb.node.nodeRef)}this._performMove(bd,bb.location.path+"/"+bb.location.file)}}else{if(B.hasClass(a5,"documentDroppable")){var a8=B.get("alf-filters"),a9=(a8?parseInt(a8.style.width,10):160);if(ba.clientX>a9){}else{var bc={elementId:a7,callback:this.onDropTargetOwnerCallBack,scope:this};YAHOO.Bubbling.fire("dropTargetOwnerRequest",bc)}this._inFlight=true;this._setFailureTimeout()}}}},_performMove:function ar(ba,bd){var a7=this.docLib.widgets.dataTable.getRecord(this.getEl()),a8="move-to/node/{nodeRef}",bc=[];bc.push(this.getEl().id);var bb=function a9(bg){this._inFlight=false;var be,bh=bg.json.successCount,bi=bg.json.failureCount;if(!bg.json.overallSuccess){this.animateResult(this.getDragEl(),this.getEl());Alfresco.util.PopupManager.displayMessage({text:this.docLib.msg("message.file-dnd-move.failure")});B.removeClass(this.dragFolderHighlight,"dndFolderHighlight");return}this.docLib._updateDocList.call(this.docLib);var bf=a7.getData();if(bf.node.isContainer){YAHOO.Bubbling.fire("folderMoved",{multiple:true,nodeRef:bf.nodeRef,destination:bd})}};var a6=function a5(be){this._inFlight=false;this.animateResult(this.getDragEl(),this.getEl());Alfresco.util.PopupManager.displayMessage({text:this.docLib.msg("message.file-dnd-move.failure")});B.removeClass(this.dragFolderHighlight,"dndFolderHighlight")};this.docLib.modules.actions.genericAction({success:{callback:{fn:bb,scope:this}},failure:{callback:{fn:a6,scope:this}},webscript:{method:Alfresco.util.Ajax.POST,name:a8,params:{nodeRef:ba.uri}},wait:{message:this.docLib.msg("message.please-wait")},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:bc,parentId:this.docLib.doclistMetadata.parent.nodeRef}}})},_currTimeoutId:null,onDropTargetOwnerCallBack:function ax(a5,a7){this._clearTimeout();var a6=new Alfresco.util.NodeRef(a5);this._performMove(a6,a7)},_clearTimeout:function al(){if(this._currTimeoutId!=null){window.clearTimeout(this._currTimeoutId);this._currTimeoutId=null;this._inFlight=false}},_setFailureTimeout:function aO(){this._clearTimeout();var a5=this;this._currTimeoutId=window.setTimeout(function(){a5.animateResult(a5.getDragEl(),a5.getEl());a5._inFlight=false;a5._currTimeoutId=null},500)},onDragOver:function a0(a7,a8){var a5=B.get(a8);if(a5.tagName=="IMG"||a5.className=="droppable"){this.dragFolderHighlight=B.getAncestorByClassName(a5,"folder");B.addClass(this.dragFolderHighlight,"dndFolderHighlight")}else{if(B.hasClass(a5,"documentDroppableHighlights")){var a6={elementId:a8,event:a7};YAHOO.Bubbling.fire("documentDragOver",a6)}}},onDragOut:function aP(a7,a8){var a5=B.get(a8);if(a5.tagName=="IMG"||a5.className=="droppable"){this.dragFolderHighlight=B.getAncestorByClassName(a5,"folder");B.removeClass(this.dragFolderHighlight,"dndFolderHighlight")}else{if(B.hasClass(a5,"documentDroppableHighlights")){var a6={elementId:a8,event:a7};YAHOO.Bubbling.fire("documentDragOut",a6)}}}});Alfresco.DocumentList=function(a5){Alfresco.DocumentList.superclass.constructor.call(this,"Alfresco.DocumentList",a5,["button","menu","container","datasource","datatable","paginator","json","history"]);this.currentPath="";this.currentPage=1;this.totalRecords=0;this.totalRecordsUpper=null;this.hideMoreActionsFn=null;this.state={actionEditOfflineActive:false};this.currentFilter={filterId:"path",filterData:""};this.actions={};this.selectedFiles={};this.afterDocListUpdate=[];this.doclistMetadata={};this.previewTooltips=[];this.insituEditors=[];this.dynamicControls=[];this.sortControls=[];this.dragAndDropAllowed=true;this.dragAndDropEnabled=false;this.dragEventRefCount=0;this.actionsView="browse";this.renderers={};this.viewRenderers={};this.dataSourceUrl=aL(Alfresco.constants.URL_SERVICECONTEXT,"components/documentlibrary/data/doclist/");YAHOO.Bubbling.on("activateDynamicControls",this.onActivateDynamicControls,this);YAHOO.Bubbling.on("activateSortControls",this.onActivateSortControls,this);YAHOO.Bubbling.on("deactivateAllControls",this.onDeactivateAllControls,this);YAHOO.Bubbling.on("deactivateDynamicControls",this.onDeactivateDynamicControls,this);YAHOO.Bubbling.on("deactivateSortControls",this.onDeactivateSortControls,this);YAHOO.Bubbling.on("metadataRefresh",this.onDocListRefresh,this);YAHOO.Bubbling.on("fileRenamed",this.onFileRenamed,this);YAHOO.Bubbling.on("changeFilter",this.onChangeFilter,this);YAHOO.Bubbling.on("filterChanged",this.onFilterChanged,this);YAHOO.Bubbling.on("folderCreated",this.onDocListRefresh,this);YAHOO.Bubbling.on("nodeCreated",this.onDocListRefresh,this);YAHOO.Bubbling.on("folderRenamed",this.onFileRenamed,this);YAHOO.Bubbling.on("highlightFile",this.onHighlightFile,this);YAHOO.Bubbling.on("registerRenderer",this.onRegisterRenderer,this);YAHOO.Bubbling.on("registerViewRenderer",this.onRegisterViewRenderer,this);YAHOO.Bubbling.on("registerAction",this.onRegisterAction,this);YAHOO.Bubbling.on("resizerChanged",this.onResizerChanged,this);YAHOO.Bubbling.on("fileCopied",this.onFileAction,this);YAHOO.Bubbling.on("fileDeleted",this.onFileAction,this);YAHOO.Bubbling.on("fileMoved",this.onFileAction,this);YAHOO.Bubbling.on("fileLinkCreated",this.onFileAction,this);YAHOO.Bubbling.on("filePermissionsUpdated",this.onFileAction,this);YAHOO.Bubbling.on("folderCopied",this.onFileAction,this);YAHOO.Bubbling.on("folderDeleted",this.onFileAction,this);YAHOO.Bubbling.on("folderMoved",this.onFileAction,this);YAHOO.Bubbling.on("folderPermissionsUpdated",this.onFileAction,this);YAHOO.Bubbling.on("filesCopied",this.onDocListRefresh,this);YAHOO.Bubbling.on("filesDeleted",this.onDocListRefresh,this);YAHOO.Bubbling.on("filesMoved",this.onDocListRefresh,this);YAHOO.Bubbling.on("filesLinkCreated",this.onDocListRefresh,this);YAHOO.Bubbling.on("filesPermissionsUpdated",this.onDocListRefresh,this);return this};YAHOO.extend(Alfresco.DocumentList,Alfresco.component.Base);YAHOO.lang.augmentProto(Alfresco.DocumentList,Alfresco.doclib.Actions);Alfresco.DocumentList.generateFilterMarkup=function w(a5){var a6=Alfresco.util.cleanBubblingObject(a5);return YAHOO.lang.substitute("{filterOwner}|{filterId}|{filterData}|{filterDisplay}",a6,function(a8,a9,a7){return typeof a9==="undefined"?"":window.escape(a9)})};Alfresco.DocumentList.generatePathMarkup=function an(a5){return Alfresco.DocumentList.generateFilterMarkup({filterId:"path",filterData:aL(a5.path,a5.file)})};Alfresco.DocumentList.generateCategoryMarkup=function l(a5){return Alfresco.DocumentList.generateFilterMarkup({filterId:"category",filterData:aL(a5[1],a5[0])})};Alfresco.DocumentList.generateFileFolderLinkMarkup=function h(bg,a9){var a5=a9.jsNode,be=Alfresco.DocumentList.getRecordSite(a9),bh=bg.options.siteId,bb=a9.location.path,bc=a9.location.repoPath,a8;if(a5.isLink){var a7=G(a5.linkedNode.properties)?a5.linkedNode.properties.name:null;var bd=a5.linkedNode.isContainer;if(!bd&&(Alfresco.constants.PAGECONTEXT=="shared"||Alfresco.constants.PAGECONTEXT=="mine")){var ba=a5.linkedNode.nodeRef.toString();a8=window.location.protocol+"//"+window.location.host+Alfresco.constants.URL_PAGECONTEXT+"document-details?nodeRef="+ba}else{if(bd){if(G(bg.options.siteId)&&a9.location.site&&a9.location.site.name!==bg.options.siteId){a8=b("documentlibrary?path="+encodeURIComponent(bb+(bb!="/"?"/":"")+a7),{site:a9.location.site.name})}else{a8=window.location.protocol+"//"+window.location.host+Alfresco.constants.URL_PAGECONTEXT+"repository?path="+encodeURIComponent(bc+(bc!="/"?"/":"")+a7)}}else{if(G(bg.options.siteId)&&a9.location.site&&a9.location.site.name!==bg.options.siteId){a8=bg.getActionUrls(a9,a9.location.site.name).documentDetailsUrl}else{a8=bg.getActionUrls(a9).documentDetailsUrl}}}}else{if(a5.isContainer){if(bh!==""&&be!==null&&bh!==be){bb=bg.currentPath}if(a9.parent.isContainer||a9.node.isContainer){var bf={};bf.path=bb;bf.file=a9.location.file;a8='#" class="filter-change" rel="'+Alfresco.DocumentList.generatePathMarkup(bf)}else{if(bb==="/"){a8='#" class="filter-change" rel="'+Alfresco.DocumentList.generateFilterMarkup({filterId:"path",filterData:aL(bb,"")})}else{a8="#"}}}else{var a6=bg.getActionUrls(a9);a8=a6.documentDetailsUrl}}return'<a href="'+a8+'">'};Alfresco.DocumentList.getRecordSite=function aD(a7){var a6=a7.location.repoPath,a9="/Sites/",a5="/documentLibrary",a8=a6.indexOf(a5);if(a6.startsWith(a9)&&a8>-1&&a8==a6.indexOf("/",a9.length)){return a6.substring(a9.length,a8)}return null};Alfresco.DocumentList.generateThumbnailUrl=function af(a5,a8){var a7=a5.jsNode,a6=a7.isLink?a7.linkedNode.nodeRef:a7.nodeRef;if(a7.isLink&&!a6){return""}if(a8==null){a8="doclib"}return Alfresco.util.generateThumbnailUrl(a7,a8)};Alfresco.DocumentList.generateFavourite=function aM(a7,a5){var a8=a5.jsNode,a9="favourite."+(a8.isContainer?"folder.":"document."),a6="";if(a5.isFavourite){a6='<a href="#" class="favourite-action enabled" title="'+a7.msg(a9+"remove.tip")+'" tabindex="0"></a>'}else{a6='<a href="#" class="favourite-action" title="'+a7.msg(a9+"add.tip")+'" tabindex="0">'+a7.msg(a9+"add.label")+"</a>"}return a6};Alfresco.DocumentList.generateLikes=function r(a8,a5){var a9=a5.node,a6=a5.likes,ba="like."+(a9.isContainer?"folder.":"document."),a7="";if(a6.isLiked){a7='<a href="#" class="like-action enabled" title="'+a8.msg(ba+"remove.tip")+'" tabindex="0"></a>'}else{a7='<a href="#" class="like-action" title="'+a8.msg(ba+"add.tip")+'" tabindex="0">'+a8.msg(ba+"add.label")+"</a>"}a7+='<span class="likes-count">'+f(a6.totalLikes)+"</span>";return a7};Alfresco.DocumentList.generateComments=function aQ(a8,a5){var bb=a5.node,ba=a8.getActionUrls(a5),a6=ba[bb.isContainer?"folderDetailsUrl":"documentDetailsUrl"]+"#comment",bc="comment."+(bb.isContainer?"folder.":"document.");var a9=(bb.properties["fm:commentCount"]!==undefined);var a7='<a href="'+a6+'" class="comment'+(a9?" hasComments":"")+'" title="'+a8.msg(bc+"tip")+'" tabindex="0">'+a8.msg(bc+"label")+"</a>";if(a9){a7+='<span class="comment-count">'+f(bb.properties["fm:commentCount"])+"</span>"}return a7};Alfresco.DocumentList.generateQuickShare=function y(a6,a5){return new Alfresco.QuickShare().setOptions({nodeRef:a5.jsNode.nodeRef,displayName:a5.displayName}).display(a5.jsNode.properties.qshare_sharedId,a5.jsNode.properties.qshare_sharedBy)};Alfresco.DocumentList.generateUserLink=function aT(a6,a5){if(a5.isDeleted===true){return"<span>"+a6.msg("details.user.deleted",f(a5.userName))+"</span>"}return o(a5.userName,YAHOO.lang.trim(a5.firstName+" "+a5.lastName))};YAHOO.lang.augmentObject(Alfresco.DocumentList.prototype,{options:{sortAscending:true,showFolders:false,simpleView:null,viewRendererName:"detailed",viewRendererNames:["simple","detailed","gallery"],viewRenderers:[],usePagination:false,siteId:"",containerId:"documentLibrary",rootNode:null,initialPage:1,pageSize:50,initialFilter:{},loadingMessageDelay:1000,highlightFile:null,previewTooltips:null,insituEditors:null,groupActivitiesAt:5,inlineEditMimetypes:{"text/plain":true,"text/html":true,"text/xml":true},replicationUrlMapping:{},listUpdated:false,repositoryBrowsing:true,useTitle:true,userIsSiteManager:false,actionsSplitAt:3,dndMaxFileLimit:0},state:{actionEditOfflineActive:false},currentPath:null,currentPage:null,totalRecords:null,currentFilter:null,fileUpload:null,actions:null,selectedFiles:null,currentActionsMenu:null,hideMoreActionsFn:null,afterDocListUpdate:null,doclistMetadata:null,dynamicControls:null,sortControls:null,dragAndDropAllowed:null,dragAndDropEnabled:null,dragEventRefCount:null,dragFolderHighlight:null,renderers:null,viewRenderers:null,_userCanUpload:false,onReady:function X(){var bi=this;this.dragAndDropEnabled=this.dragAndDropAllowed&&("draggable" in document.createElement("span"))&&YAHOO.env.ua.mobile===null;var bc=false;var a8=1;for(var ba=0,bl=this.options.viewRendererNames.length;ba<bl;ba++){if(this.options.viewRendererNames[ba]===this.options.viewRendererName){bc=true;a8=ba;break}}if(!bc&&this.options.viewRendererNames.length>0){this.options.viewRendererName=this.options.viewRendererNames[0]}this.userPreferredView=this.options.viewRendererName;this._setupMetadataRenderers();this._setupHistoryManagers();if(B.get(this.id+"-doclistBar")){this.widgets.sortAscending=Alfresco.util.createYUIButton(this,"sortAscending-button",this.onSortAscending);if(this.widgets.sortAscending!==null){this.widgets.sortAscending.set("title",this.msg(this.options.sortAscending?"button.sort.descending":"button.sort.ascending"));if(!this.options.sortAscending){B.addClass(this.widgets.sortAscending.get("element"),"sort-descending")}this.sortControls.push(this.widgets.sortAscending)}this.widgets.sortField=Alfresco.util.createYUIButton(this,"sortField-button",this.onSortField,{type:"menu",menu:"sortField-menu",lazyloadmenu:false});if(this.widgets.sortField!==null){this.sortControls.push(this.widgets.sortField);var a6=this.widgets.sortField.getMenu().getItems(),bd;for(bd in a6){if(a6.hasOwnProperty(bd)){if(a6[bd].value===this.options.sortField){this.widgets.sortField.set("label",a6[bd].cfg.getProperty("text")+" "+Alfresco.constants.MENU_ARROW_SYMBOL);break}}}}this.widgets.showFolders=Alfresco.util.createYUIButton(this,"showFolders-button",this.onShowFolders,{type:"checkbox",checked:this.options.showFolders});if(this.widgets.showFolders!==null){this.widgets.showFolders.set("title",this.msg(this.options.showFolders?"button.folders.hide":"button.folders.show"));this.dynamicControls.push(this.widgets.showFolders)}if(B.get(this.id+"-simpleDetailed")){this.widgets.viewRendererSelect=new YAHOO.widget.ButtonGroup(this.id+"-simpleDetailed");if(this.widgets.viewRendererSelect!==null){this.widgets.viewRendererSelect.check(a8);this.widgets.viewRendererSelect.on("checkedButtonChange",this.onViewRendererSelect,this.widgets.viewRendererSelect,this);this.dynamicControls.push(this.widgets.viewRendererSelect)}}this.widgets.fileSelect=Alfresco.util.createYUIButton(this,"fileSelect-button",this.onFileSelect,{type:"menu",menu:"fileSelect-menu"});if(this.widgets.fileSelect!==null){this.dynamicControls.push(this.widgets.fileSelect)}if(B.get(this.id+"-options-button")){this.widgets.optionsMenu=Alfresco.util.createYUIButton(this,"options-button",this.onOptionSelect,{type:"menu",menu:"options-menu"});if(this.widgets.optionsMenu!==null){this.dynamicControls.push(this.widgets.optionsMenu)}}}this.services.preferences=new Alfresco.service.Preferences();this.services.likes=new Alfresco.service.Ratings(Alfresco.service.Ratings.LIKES);this._setupViewRenderers();this._setupDataSource();this._setupDataTable();var bk=function a7(bq,bp){if(bi.hideMoreActionsFn){bi.hideMoreActionsFn.call(bi)}var bm=YAHOO.Bubbling.getOwnerByTagName(bp[1].anchor,"div");if(bm!==null){if(typeof bi[bm.id]==="function"){bp[1].stop=true;var bo=bp[1].target;if(typeof bi.viewRenderers[bi.options.viewRendererName]==="object"){bo=bi.viewRenderers[bi.options.viewRendererName].getDataTableRecordIdFromRowElement(bi,bp[1].target)}var bn=bi.widgets.dataTable.getRecord(bo).getData();bi[bm.id].call(bi,bn,bm)}}return true};YAHOO.Bubbling.addDefaultAction("action-link",bk);YAHOO.Bubbling.addDefaultAction("show-more",bk);var bg=function bj(bo,bn){var bm=YAHOO.Bubbling.getOwnerByTagName(bn[1].anchor,"div");if(bm!==null){bi.onLikes.call(bi,bn[1].target.offsetParent,bm)}return true};YAHOO.Bubbling.addDefaultAction("like-action",bg);var bf=function a5(bo,bn){var bm=YAHOO.Bubbling.getOwnerByTagName(bn[1].anchor,"div");if(bm!==null){bi.onFavourite.call(bi,bn[1].target.offsetParent,bm)}return true};YAHOO.Bubbling.addDefaultAction("favourite-action",bf);var bh=function a9(bo,bn){var bm=bn[1].anchor;if(bm!==null){var bp=bm.rel,bq,br={};if(bp&&bp!==""){bn[1].stop=true;bq=bp.split("|");br={filterOwner:window.unescape(bq[0]||""),filterId:window.unescape(bq[1]||""),filterData:window.unescape(bq[2]||""),filterDisplay:window.unescape(bq[3]||"")};Alfresco.logger.debug("DL_fnChangeFilterHandler","changeFilter =>",br);YAHOO.Bubbling.fire("changeFilter",br)}}return true};YAHOO.Bubbling.addDefaultAction("filter-change",bh);this.modules.actions=new Alfresco.module.DoclibActions();Q.addListener(window,"resize",this._resizeRowContainers,this,true);YAHOO.util.History.onReady(this.onHistoryManagerReady,this,true);try{YAHOO.util.History.initialize("yui-history-field","yui-history-iframe")}catch(be){Alfresco.logger.error(this.name+": Couldn't initialize HistoryManager.",be);this.onHistoryManagerReady()}var bb=new Alfresco.widget.FullScreen(this.id);this.fullscreen=bb;YAHOO.util.Event.addListener(B.get(this.id+"-fullscreen-exit-button"),"click",function(bm){bb.toggleFullScreen()});YAHOO.Bubbling.on("fullScreenEnterComplete",function(bn,bm){if(bm[1]&&bm[1].eventGroup==this.id&&(typeof this.viewRenderers[this.options.viewRendererName]==="object")&&this.viewRenderers[this.options.viewRendererName].currentResizeCallback){this.viewRenderers[this.options.viewRendererName].currentResizeCallback()}},this);YAHOO.Bubbling.on("fullScreenExitComplete",function(bn,bm){if(bm[1]&&bm[1].eventGroup==this.id&&(typeof this.viewRenderers[this.options.viewRendererName]==="object")&&this.viewRenderers[this.options.viewRendererName].currentResizeCallback){this.viewRenderers[this.options.viewRendererName].currentResizeCallback()}},this);B.setStyle(this.id+"-options-menu","display","inherit");YAHOO.Bubbling.fire("postDocumentListOnReady",{scope:this,eventGroup:this.id})},_insituCallback:function ap(a8,a6){var bc=a6.jsNode,bb=bc.nodeRef,ba="components/documentlibrary/data",a7="";if(G(this.options.siteId)){ba+="/site/"+encodeURIComponent(this.options.siteId)}else{a7="&libraryRoot="+encodeURIComponent(this.options.rootNode.toString())}Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+ba+"/node/"+bb.uri+"?filter="+encodeURIComponent(this.currentFilter.filterId)+"&view="+this.actionsView+"&noCache="+new Date().getTime()+a7,successCallback:{fn:function a5(bd){bd.json.item.jsNode=new Alfresco.util.Node(bd.json.item.node);YAHOO.Bubbling.fire(bc.isContainer?"folderRenamed":"fileRenamed",{file:bd.json.item});return false},scope:this},failureCallback:{fn:function a9(bd){},scope:this}})},fnRenderCellSelected:function aC(){var a5=this;return function a6(a8,a7,a9,ba){if(typeof a5.viewRenderers[a5.options.viewRendererName]==="object"){a5.viewRenderers[a5.options.viewRendererName].renderCellSelected(a5,a8,a7,a9,ba)}}},fnRenderCellStatus:function S(){var a5=this;return function a6(a8,a7,a9,ba){if(typeof a5.viewRenderers[a5.options.viewRendererName]==="object"){a5.viewRenderers[a5.options.viewRendererName].renderCellStatus(a5,a8,a7,a9,ba)}}},fnRenderCellThumbnail:function aY(){var a5=this;return function a6(a8,a7,a9,ba){if(typeof a5.viewRenderers[a5.options.viewRendererName]==="object"){a5.viewRenderers[a5.options.viewRendererName].renderCellThumbnail(a5,a8,a7,a9,ba)}}},fnRenderCellDescription:function aU(){var a5=this;return function a6(a8,a7,a9,ba){if(typeof a5.viewRenderers[a5.options.viewRendererName]==="object"){a5.viewRenderers[a5.options.viewRendererName].renderCellDescription(a5,a8,a7,a9,ba)}}},fnRenderCellActions:function aZ(){var a6=this;return function a5(a8,a7,a9,ba){if(typeof a6.viewRenderers[a6.options.viewRendererName]==="object"){a6.viewRenderers[a6.options.viewRendererName].renderCellActions(a6,a8,a7,a9,ba)}}},renderProperty:function(a6){if(YAHOO.lang.isString(a6)){return f(a6)}else{if(YAHOO.lang.isArray(a6)){var a5=this.renderProperty;return a6.reduce(function(a7,a8){return a5(a7)+", "+a5(a8)})}else{if(YAHOO.lang.isBoolean(a6)){return a6}else{if(YAHOO.lang.isNumber(a6)){return a6}else{if(YAHOO.lang.isObject(a6)){if(a6.hasOwnProperty("iso8601")){return P(a6.iso8601)}else{if(a6.hasOwnProperty("userName")&&a6.hasOwnProperty("displayName")){return Alfresco.util.userProfileLink(a6.userName,a6.displayName)}else{if(a6.hasOwnProperty("displayName")){return f(a6.displayName||"")}else{if(a6.hasOwnProperty("title")){return f(a6.title||"")}else{if(a6.hasOwnProperty("name")){return f(a6.name||"")}}}}}}}}}}return""},onRegisterRenderer:function T(a6,a5){var a7=a5[1];if(a7&&G(a7.propertyName)&&G(a7.renderer)){this.registerRenderer(a7.propertyName,a7.renderer)}else{Alfresco.logger.error("DL_onRegisterRenderer: Custom renderer registion invalid: "+a7)}},onRegisterViewRenderer:function n(a6,a5){var a7=a5[1];if(a7&&G(a7.renderer)){this.registerViewRenderer(a7.renderer)}else{Alfresco.logger.error("DL_onRegisterViewRenderer: Custom view renderer registion invalid: "+a7)}},registerRenderer:function aJ(a5,a6){if(G(a5)&&G(a6)){this.renderers[a5]=a6;return true}return false},registerViewRenderer:function R(a5){if(G(a5)){this.viewRenderers[a5.name]=a5;this.viewRenderers[a5.name].setupRenderer(this);return true}return false},_setupMetadataRenderers:function C(){var a5={};if(this.options.suppressComponent){a5=JSON.parse(this.options.suppressComponent)}this.registerRenderer("i18nLabel",function(a6,a7){return a7.replace(/:\s$/,"")});this.registerRenderer("lockBanner",function(a6,a8){var ba=a6.jsNode.properties,bd=ba.lockOwner||ba.workingCopyOwner,a7=Alfresco.DocumentList.generateUserLink(this,bd),bc=a6.jsNode.isContainer,bb="details.banner.",a9="";if(bc){bb+="folder."}if(a6.workingCopy&&bd.userName===Alfresco.constants.USERNAME){a9=this.msg(bb+(a6.workingCopy.isWorkingCopy?"editing":"lock-owner"))}else{if(bd.userName===Alfresco.constants.USERNAME){a9=this.msg(bb+"lock-owner")}else{a9=this.msg(bb+"locked",a7)}}return a9});this.registerRenderer("syncFailed",function(a6,a7){return'<span class="banner-more-info-link">'+this.msg("details.banner.more-info")+"</span>"+this.msg("details.banner.sync-failed")});this.registerRenderer("syncTransientError",function(a6,a7){return'<span class="banner-more-info-link">'+this.msg("details.banner.more-info")+"</span>"+this.msg("details.banner.sync-transient-error")});this.registerRenderer("date",function(a6,a7){var bc=a6.jsNode,ba=bc.properties,a9="";var a8=Alfresco.util.isSuppressed(a6.node,a5.date.browse.folder);if(!a8){var bb="modified",bd=ba.modified.iso8601;if(a6.workingCopy&&a6.workingCopy.isWorkingCopy){bb="editing-started"}else{if(bd===ba.created.iso8601){bb="created"}}a9='<span class="item">'+a7+this.msg("details."+bb+"-by",ad(bd),Alfresco.DocumentList.generateUserLink(this,ba.modifier))+"</span>"}return a9});this.registerRenderer("size",function(a6,a7){var ba=a6.jsNode,a9=ba.properties,a8="";if(!ba.isContainer&&!ba.isLink){a8+='<span class="item">'+a7+Alfresco.util.formatFileSize(ba.size)+"</span>"}return a8});this.registerRenderer("name",function(a6,a7){var ba=a6.jsNode,a9=ba.properties,a8="";if(ba.hasPermission("Write")&&!ba.isLocked&&!ba.hasAspect("cm:workingcopy")){this.insituEditors.push({context:"___"+a6._filenameId,params:{type:"textBox",nodeRef:ba.nodeRef.toString(),name:"prop_cm_name",value:a6.fileName,fnSelect:function bb(bd,be){var bc=be.lastIndexOf(Alfresco.util.getFileExtension(be))-1;if(bc>0){Alfresco.util.selectText(bd,0,bc)}else{bd.select()}},validations:[{type:Alfresco.forms.validation.length,args:{min:1,max:255,crop:true},when:"keyup",message:this.msg("validation-hint.length.min.max",1,255)},{type:Alfresco.forms.validation.nodeName,when:"keyup",message:this.msg("validation-hint.nodeName")}],title:this.msg("tip.insitu-rename"),errorMessage:this.msg("message.insitu-edit.name.failure")},callback:{fn:this._insituCallback,scope:this,obj:a6}})}a8+='<span id="___'+a6._filenameId+'">'+Alfresco.DocumentList.generateFileFolderLinkMarkup(this,a6);a8+=f(a6.displayName)+"</a></span>";return a8});this.registerRenderer("version",function(a6,a7){var ba=a6.jsNode,a9=ba.properties,a8="";if(!ba.isContainer&&!ba.isLink){a8+='<span class="item">'+a7+a6.version+"</span>"}return a8});this.registerRenderer("description",function(a6,a7){var ba=a6.jsNode,a9=ba.properties,bb=Alfresco.util.generateDomId(),a8='<span id="'+bb+'" class="faded">'+a7+this.msg("details.description.none")+"</span>";if(a9.description&&a9.description!==""){a8='<span id="'+bb+'" class="item">'+a7+am(f(a9.description))+"</span>"}return a8});this.registerRenderer("mimetype",function(a6,a8){var ba=a6.jsNode,a9="",a7="";if(!ba.isContainer&&!ba.isLink){if(typeof ba.mimetypeDisplayName!=="undefined"){a7=ba.mimetypeDisplayName}else{a7=this.msg("label.mimetype.unknown")}a9+='<span class="item">'+a8+a7+"</span>"}return a9});this.registerRenderer("tags",function(bd,bf){var a7=bd.jsNode,be=a7.properties,a6=Alfresco.util.generateDomId(),bc="";var a9=Alfresco.util.isSuppressed(bd.node,a5.tags.browse.folder);var a8=Alfresco.util.isSuppressed(bd.node,a5.tags.browse.file);if(!a9&&!a8){var bh=a7.tags,bg;if(a7.hasAspect("cm:taggable")&&bh.length>0){for(var bb=0,ba=bh.length;bb<ba;bb++){bg=f(bh[bb]);bc+='<span class="tag" style="display: inline-block"><a href="#" class="tag-link" rel="'+bg+'">'+bg+"</a></span>"}}else{bc+='<span class="faded">'+bf+this.msg("details.tags.none")+"</span>"}if(a7.hasPermission("Write")&&!a7.isLocked){this.insituEditors.push({context:a6,params:{type:"tagEditor",nodeRef:a7.nodeRef.toString(),name:"prop_cm_taggable",value:bd.node.properties["cm:taggable"],validations:[{type:Alfresco.forms.validation.nodeName,when:"keyup",message:this.msg("validation-hint.nodeName")},{type:Alfresco.forms.validation.length,args:{min:1,max:255,crop:true,ignoreEmpty:true},when:"keyup",message:this.msg("validation-hint.length.min.max",1,255)}],title:this.msg("tip.insitu-tag"),errorMessage:this.msg("message.insitu-edit.tag.failure")},callback:{fn:this._insituCallback,scope:this,obj:bd}})}return'<span id="'+a6+'" class="item">'+bf+bc+"</span>"}return""});this.registerRenderer("categories",function(bc,be){var a6=bc.jsNode,bd=a6.properties,ba="";if(a6.hasAspect("cm:generalclassifiable")){var bb=a6.categories,a7;ba+='<span class="category-item item">&nbsp;</span><span class="item">'+be;if(bb.length>0){for(var a9=0,a8=bb.length;a9<a8;a9++){a7=bb[a9];ba+='<span class="category"><a href="#" class="filter-change" rel="'+Alfresco.DocumentList.generateCategoryMarkup(a7)+'">'+f(a7[0])+"</a></span>"+(a8-a9>1?", ":"")}}else{ba+='<span class="faded">'+be+this.msg("details.categories.none")+"</span>"}ba+="</span>"}return ba});this.registerRenderer("social",function(a6){var ba=a6.jsNode,a8="";var a7=Alfresco.util.isSuppressed(a6.node,a5.social.browse.folder);var a9=Alfresco.util.isSuppressed(a6.node,a5.social.browse.file);if(!a7&&!a9){a8+='<span class="item item-social">'+Alfresco.DocumentList.generateFavourite(this,a6)+"</span>";a8+='<span class="item item-social item-separator">'+Alfresco.DocumentList.generateLikes(this,a6)+"</span>";if(ba.permissions.user.CreateChildren){a8+='<span class="item item-social item-separator">'+Alfresco.DocumentList.generateComments(this,a6)+"</span>"}if(!a6.node.isContainer&&Alfresco.constants.QUICKSHARE_URL){a8+='<span class="item item-separator">'+Alfresco.DocumentList.generateQuickShare(this,a6)+"</span>"}}return a8})},_setupViewRenderers:function W(){for(var a7=0;a7<this.options.viewRenderers.length;a7++){var a8=this.options.viewRenderers[a7].widget;if(a8!=null){var a6=a8.split(".");var a9=window;for(var a5=0;a5<a6.length;a5++){a9=a9[a6[a5]]}if(typeof a9==="function"){this.registerViewRenderer(new a9(this.options.viewRenderers[a7].id,this,this.options.commonComponentStyle,this.options.viewRenderers[a7].jsonConfig))}}}YAHOO.Bubbling.fire("postSetupViewRenderers",{scope:this,eventGroup:this.id})},_setupHistoryManagers:function ay(){var a8=YAHOO.util.History.getBookmarkedState("filter");a8=a8||"path|/";try{while(a8!==(a8=decodeURIComponent(a8.replace(/%25/g,"%2525")))){}}catch(bb){}var a6=function bd(be){var bf=be.split("|"),bg={filterId:window.unescape(bf[0]||"")};if(typeof bf[1]!=="undefined"){bg.filterData=window.unescape(bf[1])}if(typeof bf[2]!=="undefined"){bg.filterDisplay=window.unescape(bf[2])}bg.filterOwner=Alfresco.util.FilterManager.getOwner(bg.filterId);return bg};this.options.initialFilter=a6(a8);YAHOO.util.History.register("filter",a8,function a5(bf){Alfresco.logger.debug("HistoryManager: filter changed:"+bf);var be=YAHOO.util.History.getBookmarkedState("page")||"1";while(be!==(be=decodeURIComponent(be))){}var bg=parseInt(be||this.options.initialPage,10);if(this.currentPage!=bg){this.currentPage=bg}this._updateDocList.call(this,{filter:a6(bf),page:this.currentPage})},null,this);var a7=function a9(bf,be){be.widgets.paginator.setState(bf);YAHOO.util.History.navigate("page",String(bf.page))};if(this.options.usePagination){var bc=YAHOO.util.History.getBookmarkedState("page")||"1";while(bc!==(bc=decodeURIComponent(bc))){}this.currentPage=parseInt(bc||this.options.initialPage,10);YAHOO.util.History.register("page",bc,function ba(be){Alfresco.logger.debug("HistoryManager: page changed:"+be);if(this.currentPage!=be){this.selectedFiles={};this._updateDocList.call(this,{page:be})}else{Alfresco.logger.debug("...page changed event ignored.")}},null,this);this.widgets.paginator=new YAHOO.widget.Paginator({containers:[this.id+"-paginator",this.id+"-paginatorBottom"],rowsPerPage:this.options.pageSize,initialPage:this.currentPage,template:this.msg("pagination.template"),pageReportTemplate:this.msg("pagination.template.page-report"),previousPageLinkLabel:this.msg("pagination.previousPageLinkLabel"),nextPageLinkLabel:this.msg("pagination.nextPageLinkLabel")});this.widgets.paginator.subscribe("changeRequest",a7,this);B.setStyle(this.id+"-doclistBarBottom","display","block")}},_setupDataSource:function ae(){var a6=this;this.widgets.dataSource=new YAHOO.util.DataSource(this.dataSourceUrl,{responseType:YAHOO.util.DataSource.TYPE_JSON,responseSchema:{resultsList:"items",metaFields:{paginationRecordOffset:"startIndex",totalRecords:"totalRecords",totalRecordsUpper:"totalRecordsUpper"}}});this.widgets.dataSource.doBeforeCallback=function a5(a9,a7,ba){a6.doclistMetadata=a7.metadata;YAHOO.Bubbling.fire("doclistMetadata",{metadata:a6.doclistMetadata});var a8=null;if(a6.doclistMetadata.parent){a8=a6.doclistMetadata.parent.permissions;if(a8&&a8.user){YAHOO.Bubbling.fire("userAccess",{userAccess:a8.user})}}if(typeof a6.viewRenderers[a6.options.viewRendererName]==="object"){a6.viewRenderers[a6.options.viewRendererName].renderEmptyDataSourceHtml(a6,a8)}return ba}},_setupDataTable:function aV(){var be=this;var a6=B.get("alf-filters"),a7=(a6?parseInt(a6.style.width,10):160)+390;var a8=[{key:"nodeRef",label:"Select",sortable:false,formatter:this.fnRenderCellSelected(),width:16},{key:"status",label:"Status",sortable:false,formatter:this.fnRenderCellStatus(),width:16},{key:"thumbnail",label:"Preview",sortable:false,formatter:this.fnRenderCellThumbnail(),width:100},{key:"fileName",label:"Description",sortable:false,formatter:this.fnRenderCellDescription(),width:(B.getViewportWidth()-a7)},{key:"actions",label:"Actions",sortable:false,formatter:this.fnRenderCellActions(),width:200}];this.widgets.dataTable=new YAHOO.widget.DataTable(this.id+"-documents",a8,this.widgets.dataSource,{renderLoopSize:this.options.usePagination?16:Alfresco.util.RENDERLOOPSIZE,initialLoad:false,dynamicData:true,MSG_EMPTY:this.msg("message.loading")});var bd=B.getElementsByClassName("yui-dt-empty");if(bd.length>0){bd[0].colSpan=100}this.widgets.dataTable.handleDataReturnPayload=function ba(bg,bf,bh){be.totalRecords=bf.meta.totalRecords;be.totalRecordsUpper=bf.meta.totalRecordsUpper;return bf.meta};this._setDefaultDataTableErrors(this.widgets.dataTable);this.widgets.dataTable.subscribe("tableMsgShowEvent",function(bk){this._elMsgTbody.parentNode.style.width="";if(bk.html&&bk.html.indexOf("docListInstructions")!==-1){var bn=Alfresco.util.ComponentManager.findFirst("Alfresco.DocListToolbar");if(bn!==null){var bl=B.get(be.id+"-standard-upload-link-template-instance");if(bl!==null){var bo=B.getChildren(bl);Q.addListener(bo[0],"click",bn.onFileUpload,bn,true);Q.addListener(B.getFirstChild(bo[1]),"click",bn.onFileUpload,bn,true)}var bj=B.get(be.id+"-new-folder-link-template-instance");if(bj!==null){var bm=B.getChildren(bj);Q.addListener(bm[0],"click",bn.onNewFolder,bn,true);Q.addListener(B.getFirstChild(bm[1]),"click",bn.onNewFolder,bn,true)}}var bf=B.get(be.id+"-show-folders-template-instance");if(bf!==null){var bh=function bg(){var bp=B.getElementsByClassName("showFolders")[0];be.options.showFolders=true;bp.innerHTML=this.msg("button.folders.hide");B.replaceClass(bp,"showFolders","hideFolders");be.services.preferences.set(aa,be.options.showFolders);YAHOO.Bubbling.fire("metadataRefresh")};var bi=B.getChildren(bf);Q.addListener(bi[0],"click",bh,be,true);Q.addListener(bi[1],"click",bh,be,true)}}});this.widgets.dataTable.sortColumn=function(bk,bi){var bf=this.getColumnSortDir(bk);var bl=this.get("sortedBy")||{};var bg=(bl.key===bk.key)?true:false;var bh=this.getState();bh.sortedBy={key:bk.key,dir:bf};this.set("sortedBy",bh.sortedBy);var bj="ascending";if(bf!="yui-dt-asc"){bj="descending"}be.onSortFieldEvent(bk.field,bj)};this.widgets.dataTable.doBeforeLoadData=function a5(bh,bj,bl){if(bj.error){try{var bf=YAHOO.lang.JSON.parse(bj.responseText);be.widgets.dataTable.set("MSG_ERROR",bf.message)}catch(bk){be._setDefaultDataTableErrors(be.widgets.dataTable)}}else{if(bj.results.length===0){B.setStyle(be.widgets.dataTable._elThead,"display","none");this.fireEvent("renderEvent",{type:"renderEvent"})}else{for(var bg=0,bi=bj.results.length;bg<bi;bg++){bj.results[bg].jsNode=new Alfresco.util.Node(bj.results[bg].node)}}}return true};this.widgets.dataTable.subscribe("checkboxClickEvent",function bb(bf){var bg=bf.target.value;this.selectedFiles[bg]=bf.target.checked;YAHOO.Bubbling.fire("selectedFilesChanged")},this,true);this.widgets.dataTable.subscribe("renderEvent",function bc(){Alfresco.logger.debug("DataTable renderEvent");var bl=Alfresco.util.ComponentManager.findFirst("Alfresco.DocListToolbar");if(bl&&bl.isVirtualFolder()){B.addClass(this.id+"-new-folder-link-template-instance","hidden")}if(0<YAHOO.env.ua.ie&&YAHOO.env.ua.ie<7){var bg=this.widgets.dataTable.getTableEl().parentNode;bg.className=bg.className}if(this.widgets.paginator){Alfresco.logger.debug("Setting paginator state: page="+this.currentPage+", totalRecords="+this.totalRecords);this.widgets.paginator.setState({page:this.currentPage,totalRecords:this.totalRecords});if(this.totalRecordsUpper){this.widgets.paginator.set("pageReportTemplate",this.msg("pagination.template.page-report.more"))}else{this.widgets.paginator.set("pageReportTemplate",this.msg("pagination.template.page-report"))}this.widgets.paginator.render()}if(this.options.highlightFile){YAHOO.Bubbling.fire("highlightFile",{fileName:window.unescape(this.options.highlightFile)})}else{if(this.listUpdated){var bk=B.getY(this.id+"-documents"),bf=YAHOO.env.ua.ie>0?((document.compatMode&&document.compatMode!=="BackCompat")?document.documentElement:document.body).scrollTop:window.scrollY;if(bf>bk){window.scrollTo(0,bk)}}}var bj,bi;for(bj=0,bi=this.afterDocListUpdate.length;bj<bi;bj++){this.afterDocListUpdate[bj].call(this)}this.afterDocListUpdate=[];if(typeof this.widgets.previewTooltip!=="undefined"){this.widgets.previewTooltip.cfg.setProperty("context",this.previewTooltips)}var bh;for(bj=0,bi=this.insituEditors.length;bj<bi;bj++){bh=this.insituEditors[bj];Alfresco.util.createInsituEditor(bh.context,bh.params,bh.callback)}this.widgets.dataTable.set("renderLoopSize",this.options.usePagination?16:Alfresco.util.RENDERLOOPSIZE)},this,true);this.widgets.dataTable.subscribe("rowMouseoverEvent",this.onEventHighlightRow,this,true);this.widgets.dataTable.subscribe("rowMouseoutEvent",this.onEventUnhighlightRow,this,true);Q.delegate(this.id,"click",function a9(bh,bj){var bi=bj.getAttribute("data-action"),bk=be.widgets.dataTable.getRecord(bj),bf;if(bk==null){var bl=be.currentActionsMenu.id;var bg=be.widgets.dataTable.getRecordSet()._records;for(i=0;i<bg.length;i++){if(bl.indexOf(bg[i]._sId)>0){bk=be.widgets.dataTable.getRecord(bg[i]._sId);bj=bk._sId}}}if(bk!=null){bf=bk.getData()}if(YAHOO.lang.isFunction(be[bi])){be[bi].call(be,bf,bj)}else{if(YAHOO.lang.isFunction(window[bi])){window[bi](bf,bj)}}},"a.indicator-action");if(this.dragAndDropEnabled){Q.addListener(document.body,"dragenter",this._swallowDragEnter,this,true);Q.addListener(document.body,"dragover",this._swallowDragOver,this,true);Q.addListener(document.body,"drop",this._swallowDragDrop,this,true);Q.addListener(document.body,"dragstart",this._swallowDragStart,this,true)}},_removeDragAndDrop:function av(){if(this.dragAndDropEnabled){try{var a6=B.get(this.id+"-dl-body");Q.removeListener(a6,"dragenter");Q.removeListener(a6,"dragover");Q.removeListener(a6,"dragleave");Q.removeListener(a6,"drop")}catch(a5){Alfresco.logger.error("_removeDragAndDrop: The following exception occurred: ",a5)}}},_addDragAndDrop:function I(){if(this._userCanUpload&&this.dragAndDropEnabled){try{var a6=B.get(this.id+"-dl-body");Q.addListener(a6,"dragenter",this.onDocumentListDragEnter,this,true);Q.addListener(a6,"dragover",this.onDocumentListDragOver,this,true);Q.addListener(a6,"dragleave",this.onDocumentListDragLeave,this,true);Q.addListener(a6,"drop",this.onDocumentListDrop,this,true)}catch(a5){Alfresco.logger.error("_addDragAndDrop: The following exception occurred: ",a5)}}},_swallowDragStart:function s(a5){a5.stopPropagation();a5.preventDefault()},_swallowDragEnter:function t(a5){a5.stopPropagation();a5.preventDefault()},_swallowDragOver:function ag(a5){a5.dataTransfer.dropEffect="none";a5.stopPropagation();a5.preventDefault()},_swallowDrop:function aA(a5){a5.stopPropagation();a5.preventDefault()},onDocumentListDragEnter:function aq(ba){var a6=ba.target,a8=this.widgets.dataTable.getRecord(a6),a5=this.widgets.dataTable.getColumn(a6),a9=this.widgets.dataTable.getContainerEl(),a7;if(a8&&a5&&(a6.tagName=="IMG"||a6.className=="droppable")&&a5.getKey()=="thumbnail"){a7=a8.getData("jsNode");if(a7&&a7.isContainer){this.dragFolderHighlight=B.getAncestorByClassName(a6,"folder");B.addClass(this.dragFolderHighlight,"dndFolderHighlight");B.removeClass(a9,"dndDocListHighlight")}}else{this.dragEventRefCount=Math.min(++this.dragEventRefCount,2);B.addClass(a9,"dndDocListHighlight");if(this.dragFolderHighlight){B.removeClass(this.dragFolderHighlight,"dndFolderHighlight");this.dragFolderHighlight=null}}ba.stopPropagation();ba.preventDefault()},onDocumentListDragOver:function m(a5){a5.dataTransfer.dropEffect=Math.floor(YAHOO.env.ua.gecko)===1?"move":"copy";a5.stopPropagation();a5.preventDefault()},onDocumentListDragLeave:function a1(a9){var a6=a9.target,a7=this.widgets.dataTable.getRecord(a6),a8=this.widgets.dataTable.getColumn(a6),a5=a7?a7.getData():null;if(a7&&a8&&(a6.tagName=="IMG"||a6.className=="droppable")&&a5.node.isContainer&&a8.getKey()=="thumbnail"){}else{if(--this.dragEventRefCount===0){B.removeClass(this.widgets.dataTable.getContainerEl(),"dndDocListHighlight")}}a9.stopPropagation();a9.preventDefault()},onDocumentListDrop:function ai(bo){try{if(bo.dataTransfer.files!==undefined&&bo.dataTransfer.files!==null&&bo.dataTransfer.files.length>0){var bn=Alfresco.getDNDUploadProgressInstance();var bk=true;if(bn.uploadMethod===bn.INMEMORY_UPLOAD){var a7=0;j=bo.dataTransfer.files.length;for(i=0;i<j;i++){a7+=bo.dataTransfer.files[i].size}if(a7>bn.getInMemoryLimit()){bk=false;Alfresco.util.PopupManager.displayPrompt({text:bn.msg("inmemory.uploadsize.exceeded",Alfresco.util.formatFileSize(bn.getInMemoryLimit()))})}}if(bk){var a5=this.currentPath,bm=a5.substring(a5.lastIndexOf("/")+1),br=this.doclistMetadata.parent?this.doclistMetadata.parent.nodeRef:null,bl=br;var bq=this.widgets.dataTable.getRecord(bo.target);if(bq!==null){var bi=this.widgets.dataTable.getColumn(bo.target),bc=bq.getData();if((bo.target.tagName=="IMG"||bo.target.className=="droppable")&&bc.jsNode.isContainer){var a8=bc.location;bm=a8.file;a5=aL(a8.path,a8.file);bl=bc.nodeRef}}B.removeClass(this.widgets.dataTable.getTrEl(bo.target),"dndFolderHighlight");B.removeClass(this.widgets.dataTable.getContainerEl(),"dndDocListHighlight");var be=[];var bf={uploadDirectoryName:bm,parentNodeRef:br,filter:[],mode:bn.MODE_MULTI_UPLOAD,thumbnails:"doclib",onFileUploadComplete:{fn:function bh(bs){if(be.length!==0){var bt={destination:bl,paths:be};Alfresco.util.Ajax.jsonRequest({method:"POST",url:Alfresco.constants.PROXY_URI+"slingshot/doclib2/mkdir",dataObj:bt})}this.onFileUploadComplete(bs)},scope:this}};if(G(this.options.siteId)){bf.siteId=this.options.siteId;bf.containerId=this.options.containerId;bf.uploadDirectory=a5}else{bf.destination=bl}var ba=this.options.dndMaxFileLimit;var bd=function a6(bt,by,bv){by.limit=ba;by.pending=by.pending||0;by.files=by.files||[];by.dirmap=by.dirmap||{};var bs=bt.createReader(),bu=bt.fullPath.replace(/^\//,"");var bw=function bx(){by.pending++;bs.name=bt.name;bs.readEntries(function bz(bA){by.pending--;bA.forEach(function(bB){if(bB.isFile){by.pending++;bB.file(function(bC){switch(bC.name.toLowerCase()){case"thumbs.db":case"desktop.ini":case".ds_store":break;default:if(by.dirmap[bt.fullPath]){by.dirmap[bt.fullPath].push(bB.name)}bC.relativePath=bu;by.files.push(bC);if(by.limit&&by.files.length>by.limit){throw new Error("Maximum dnd file limit reached: "+by.limit)}}if(--by.pending===0){by(by.files,by.dirmap)}},bv)}else{by.dirmap[bB.fullPath]=[];bd(bB,by,bv)}});if(bA.length!==0){bw()}if(by.pending===0){by(by.files,by.dirmap)}},bv)};bw()};var a9=function bb(bs){bf.files=bs;bn.show(bf)};var bj=bo.dataTransfer.items||[],bp;if(bj[0]&&bj[0].webkitGetAsEntry&&(bp=bj[0].webkitGetAsEntry())){bd(bp.filesystem.root,function(bt,bu){Object.keys(bu).forEach(function(bx){if(bu[bx].length===0){be.push(bx)}});for(var bv,bw=0;bw<be.length;bw++){bv=be[bw];for(var bs=0;bs<be.length;bs++){if(bs!==bw&&be[bs].indexOf(bv)===0){be.splice(bw--,1);break}}}a9(bt)},function(){a9(bo.dataTransfer.files)})}else{a9(bo.dataTransfer.files)}}}else{Alfresco.logger.debug("DL_onDocumentListDrop: A drop event was detected, but no files were present for upload: ",bo.dataTransfer)}}catch(bg){Alfresco.logger.error("DL_onDocumentListDrop: The following error occurred when files were dropped onto the Document List: ",bg)}bo.stopPropagation();bo.preventDefault()},onHistoryManagerReady:function z(){if(this.options.initialFilter.filterId==="path"&&window.location.hash=="#upload"){window.location.hash="";var a5=function a6(){YAHOO.Bubbling.fire("showFileUploadDialog",{tooltip:this.msg("dnd.upload.tooltip")})};this.afterDocListUpdate.push(a5)}Alfresco.logger.debug("DL_onHistoryManagerReady","changeFilter =>",this.options.initialFilter);YAHOO.Bubbling.fire("changeFilter",YAHOO.lang.merge({doclistFirstTimeNav:true},this.options.initialFilter));B.setStyle(this.id+"-dl-body","visibility","visible")},getSelectedFiles:function a4(){var a9=[],ba=this.widgets.dataTable.getRecordSet(),a8,a7,a6,a5;for(a6=0,a5=ba.getLength();a6<a5;a6++){a8=ba.getRecord(a6);a7=a8.getData("node");if(this.selectedFiles[a7.nodeRef]){a9.push(a8.getData())}}return a9},selectFiles:function A(bg){var bh;if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){bh=B.get(this.id+this.viewRenderers[this.options.viewRendererName].parentElementIdSuffix)}var bc=this.widgets.dataTable.getRecordSet(),a7=YAHOO.util.Selector.query('input[type="checkbox"]',bh),bb=a7.length,bi,a9,a8,bf;switch(bg){case"selectAll":bf=function bd(bj,bk){return true};break;case"selectNone":bf=function ba(bj,bk){return false};break;case"selectInvert":bf=function a6(bj,bk){return !bk};break;case"selectDocuments":bf=function a5(bj,bk){return !(bj.node.isContainer)};break;case"selectFolders":bf=function a5(bj,bk){return bj.node.isContainer};break;default:bf=function be(bj,bk){return bk}}for(a8=0;a8<bb;a8++){bi=bc.getRecord(a8);a9=bi.getData();this.selectedFiles[a9.nodeRef]=a7[a8].checked=bf(a9,a7[a8].checked)}YAHOO.Bubbling.fire("selectedFilesChanged")},onSortAscending:function Z(a5,a6){this.widgets.dataTable.set("sortedBy",null);this.options.sortAscending=!this.options.sortAscending;this.widgets.sortAscending.set("title",this.msg(this.options.sortAscending?"button.sort.descending":"button.sort.ascending"));if(this.options.sortAscending){B.removeClass(this.widgets.sortAscending.get("element"),"sort-descending")}else{B.addClass(this.widgets.sortAscending.get("element"),"sort-descending")}this.services.preferences.set(aH,this.options.sortAscending);YAHOO.Bubbling.fire("metadataRefresh");if(a5){Q.preventDefault(a5)}},onSortEvent:function a3(a5){this.options.sortAscending=(a5!="descending");this.services.preferences.set(aH,this.options.sortAscending);YAHOO.Bubbling.fire("metadataRefresh")},onSortField:function aS(ba,a9,a8){this.widgets.dataTable.set("sortedBy",null);var a5=a9[0],a7=a9[1];if(a7){var a6=this;this.options.sortField=a7.value;this.widgets.sortField.set("label",a7.cfg.getProperty("text")+" "+Alfresco.constants.MENU_ARROW_SYMBOL);this.services.preferences.set(d,this.options.sortField,{successCallback:{fn:function(){var bb=a7.srcElement.getAttribute("title");if(bb==="true"||bb==="false"){a6.options.sortAscending=(bb==="false");a6.onSortAscending()}else{YAHOO.Bubbling.fire("metadataRefresh")}}}})}Q.preventDefault(a5)},onSortFieldEvent:function M(a7,a6){this.options.sortField=a7;var a5=this;this.services.preferences.set(d,a7,{successCallback:{fn:function(){if(a6){a5.options.sortAscending=(a6==="ascending");a5.onSortEvent(a6)}else{YAHOO.Bubbling.fire("metadataRefresh")}}}})},onShowFolders:function k(a5,a6){this.options.showFolders=this.widgets.showFolders.get("checked");this.widgets.showFolders.set("title",this.msg(this.options.showFolders?"button.folders.hide":"button.folders.show"));this.services.preferences.set(aa,this.options.showFolders);YAHOO.Bubbling.fire("metadataRefresh");if(a5){Q.preventDefault(a5)}},onShowFoldersEvent:function p(a5){this.options.showFolders=a5;this.services.preferences.set(aa,this.options.showFolders);YAHOO.Bubbling.fire("metadataRefresh")},onViewRendererSelect:function a2(a5,a6){this.widgets.dataTable.set("sortedBy",null);this.options.viewRendererName=this.options.viewRendererNames[a5.newValue.index];this.userPreferredView=this.options.viewRendererName;this.services.preferences.set(ab,this.options.viewRendererName);YAHOO.Bubbling.fire("metadataRefresh");if(a5){Q.preventDefault(a5)}},onViewRendererSelectEvent:function aF(a5){var a8=false;for(var a7=0;a7<this.options.viewRendererNames.length&&!a8;a7++){a8=(this.options.viewRendererNames[a7]==a5)}if(a8){this.widgets.dataTable.set("sortedBy",null);this.options.viewRendererName=a5;this.userPreferredView=this.options.viewRendererName;this.services.preferences.set(ab,this.options.viewRendererName);for(var a7=0;a7<this.options.viewRenderers.length;a7++){if(this.options.viewRenderers[a7].id==this.options.viewRendererName){var a6=B.getElementsByClassName("setDefaultView");a6[0].innerHTML=this.msg("button.setDefaultView",this.options.viewRenderers[a7].label);break}}YAHOO.Bubbling.fire("metadataRefresh")}},onFileSelect:function c(a9,a8,a7){var a5=a8[0],a6=a8[1];this.selectFiles(Alfresco.util.findEventClass(a6))},onOptionSelect:function aG(a6,bc,bi){var bd=bc[0],bh=bc[1];var a8=Alfresco.util.findEventClass(bh);var a7=bh.element;while((a7!==null)&&((a7.tagName.toLowerCase()!="span")||(a7.className.indexOf("yui")===0))){a7=a7.firstChild}var be=a7;if(a8=="showFolders"){this.options.showFolders=true;be.innerHTML=this.msg("button.folders.hide");B.replaceClass(be,"showFolders","hideFolders");this.services.preferences.set(aa,this.options.showFolders);YAHOO.Bubbling.fire("metadataRefresh")}else{if(a8=="hideFolders"){this.options.showFolders=false;be.innerHTML=this.msg("button.folders.show");B.replaceClass(be,"hideFolders","showFolders");this.services.preferences.set(aa,this.options.showFolders);YAHOO.Bubbling.fire("metadataRefresh")}else{if(a8=="showPath"){this.options.hideNavBar=false;be.innerHTML=this.msg("button.navbar.hide");B.replaceClass(be,"showPath","hidePath");this.services.preferences.set(F,this.options.hideNavBar);B.setStyle(this.options.associatedToolbar.id+"-navBar","display",this.options.hideNavBar?"none":"block")}else{if(a8=="hidePath"){this.options.hideNavBar=true;be.innerHTML=this.msg("button.navbar.show");B.replaceClass(be,"hidePath","showPath");this.services.preferences.set(F,this.options.hideNavBar);B.setStyle(this.options.associatedToolbar.id+"-navBar","display",this.options.hideNavBar?"none":"block")}else{if(a8=="fullWindow"){this.fullscreen.toggleFullScreen(true)}else{if(a8=="fullScreen"){this.fullscreen.toggleFullScreen(false)}else{if(a8=="rss"){window.location=this.options.associatedToolbar._getRssFeedUrl()}else{if(a8=="removeDefaultView"||a8=="setDefaultView"){if(a8=="setDefaultView"){for(var ba=0;ba<this.options.viewRenderers.length;ba++){if(this.options.viewRenderers[ba].id==this.options.viewRendererName){var bf=B.getElementsByClassName("removeDefaultView");bf[0].innerHTML=this.msg("button.removeDefaultView",this.options.viewRenderers[ba].label);break}}}var bg=this.doclistMetadata.parent.nodeRef;bg=bg.replace(/:\//g,"");var bb=this;var a5={prop_app_defaultViewId:(a8=="removeDefaultView"?"":this.options.viewRendererName)};Alfresco.util.Ajax.jsonRequest({method:"POST",url:Alfresco.constants.PROXY_URI+"api/node/"+bg+"/formprocessor",dataObj:a5,successCallback:{fn:function(){this._updateDocList.call(this)},scope:this},failure:{message:bb.msg("message.save.failure")}})}else{if(a8.indexOf=="view "!=-1){var a9=a8.substring(5);this.onViewRendererSelectEvent(a9)}}}}}}}}}Q.preventDefault(bd)},onEventHighlightRow:function ac(a5){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onEventHighlightRow(this,a5)}},onEventUnhighlightRow:function L(a5){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onEventUnhighlightRow(this,a5)}},onActionShowMore:function E(a6,a5){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onActionShowMore(this,a6,a5)}},onActionEditOffline:function V(a7){if(!this.state.actionEditOfflineActive){this.state.actionEditOfflineActive=true;var a8=a7.jsNode.nodeRef,a6=a7.displayName;this.modules.actions.genericAction({success:{event:{name:"metadataRefresh"},callback:{fn:function a9(bc){this.state.actionEditOfflineActive=false;this.options.highlightFile=a6;var bb=function ba(){var bd=false;YAHOO.Bubbling.on("editingCanceled",function(bi,bh){if(bc.config.object.nodeRef==bh[1].record.workingCopy.sourceNodeRef.replace(/:\//g,"")){bd=true}},this);var bg=Alfresco.constants.PROXY_URI+bc.json.results[0].downloadUrl;if(YAHOO.env.ua.ie>6){Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.edit-offline.success",a6),text:this.msg("message.edit-offline.success.ie7"),buttons:[{text:this.msg("button.download"),handler:function bf(){window.open(bg,"_blank");this.destroy()},isDefault:true},{text:this.msg("button.close"),handler:function be(){this.destroy()}}]})}else{Alfresco.util.PopupManager.displayMessage({text:this.msg("message.edit-offline.success",a6)});YAHOO.lang.later(3000,this,function(){if(!bd){window.location=bg}})}};this.afterDocListUpdate.push(bb)},scope:this}},failure:{callback:{fn:function a5(){this.state.actionEditOfflineActive=false},scope:this},message:this.msg("message.edit-offline.failure",a6)},webscript:{method:Alfresco.util.Ajax.POST,name:"checkout/node/{nodeRef}",params:{nodeRef:a8.uri}}})}},_checkIfUpdatedPageIsEmpty:function v(){var a5=(this.currentPage-1)*this.options.pageSize;if(a5>=this.totalRecords){this.widgets.paginator.setPage(1);this.currentPage=1}},_unselectFile:function aX(a6){var a5=a6.action;if(a5&&(a5=="fileCopied"||a5=="fileMoved"||a5=="folderCopied"||a5=="folderMoved"||a5=="fileLinkCreated")){if(this.selectedFiles[a6.nodeRef]){this.selectedFiles[a6.nodeRef]=false}}},onFileAction:function aE(a6,a5){var a7=a5[1];if(a7){this._unselectFile(a7);if(!a7.multiple){this._checkIfUpdatedPageIsEmpty();this._updateDocList.call(this)}}},onFileRenamed:function N(a6,a5){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onFileRenamed(this,a6,a5)}},_unselectCopiedFiles:function J(a7){if((a7.action=="filesCopied"||a7.action=="filesLinkCreated")&&a7.sourceFilesObj&&a7.sourceFilesObj.nodeRefs){var a8=a7.sourceFilesObj.nodeRefs;for(var a6=0,a5=a8.length;a6<a5;a6++){if(this.selectedFiles[a8[a6]]){this.selectedFiles[a8[a6]]=false}}}},onDocListRefresh:function ah(a6,a5){var a7=a5[1];this._unselectCopiedFiles(a7);if(a7&&(a7.highlightFile!==null)){this.options.highlightFile=a7.highlightFile}this._checkIfUpdatedPageIsEmpty();this._updateDocList.call(this)},onChangeFilter:function K(a7,a6){var ba=a6[1];if((ba!==null)&&(ba.filterId!==null)){var a9=Alfresco.util.cleanBubblingObject(ba),a8=window.escape(ba.filterId)+(typeof ba.filterData!=="undefined"?"|"+window.escape(ba.filterData)+(typeof ba.filterDisplay!=="undefined"?"|"+window.escape(ba.filterDisplay):""):"");Alfresco.logger.debug("DL_onChangeFilter: ",a9);this._removeDragAndDrop();if(ba.filterId==="path"||ba.filterId==="favourites"){this._addDragAndDrop()}this.listUpdated=true;var a5={filter:a8};if(ba.doclistFirstTimeNav||a8===YAHOO.util.History.getCurrentState("filter")){this._updateDocList.call(this,{filter:a9,page:this.currentPage})}else{if(this.options.usePagination){this.currentPage=1;a5.page="1"}Alfresco.logger.debug("DL_onChangeFilter: objNav = ",a5);if(this.options.highlightFile&&a5.filter===YAHOO.util.History.getCurrentState("filter")){YAHOO.Bubbling.fire("highlightFile",{fileName:this.options.highlightFile})}YAHOO.util.History.multiNavigate(a5)}}},onFilterChanged:function x(a6,a5){var a7=a5[1];if((a7!==null)&&(a7.filterId!==null)){a7.filterOwner=a7.filterOwner||Alfresco.util.FilterManager.getOwner(a7.filterId);this.currentFilter=Alfresco.util.cleanBubblingObject(a7);Alfresco.logger.debug("DL_onFilterChanged: ",this.currentFilter)}},onHighlightFile:function aj(a6,a5){if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].onHighlightFile(this,a6,a5)}},onDeactivateAllControls:function Y(a7,a6){var a5,a8=Alfresco.util.disableYUIButton;for(a5 in this.widgets){if(this.widgets.hasOwnProperty(a5)){a8(this.widgets[a5])}}},onDeactivateDynamicControls:function au(a7,a6){var a5,a8=Alfresco.util.disableYUIButton;for(a5 in this.dynamicControls){if(this.dynamicControls.hasOwnProperty(a5)){a8(this.dynamicControls[a5])}}},onDeactivateSortControls:function aI(a7,a6){var a5,a8=Alfresco.util.disableYUIButton;for(a5 in this.sortControls){if(this.sortControls.hasOwnProperty(a5)){a8(this.sortControls[a5])}}},onActivateSortControls:function g(a7,a6){var a5,a8=Alfresco.util.enableYUIButton;for(a5 in this.sortControls){if(this.sortControls.hasOwnProperty(a5)){a8(this.sortControls[a5])}}},onActivateDynamicControls:function H(a7,a6){var a5,a8=Alfresco.util.enableYUIButton;for(a5 in this.dynamicControls){if(this.dynamicControls.hasOwnProperty(a5)){a8(this.dynamicControls[a5])}}},onLikes:function D(bb){var a8=bb;if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){a8=this.viewRenderers[this.options.viewRendererName].getDataTableRecordIdFromRowElement(this,bb)}var bc=this.widgets.dataTable.getRecord(a8),a9=bc.getData(),ba=a9.jsNode.nodeRef,a6=a9.likes;a6.isLiked=!a6.isLiked;a6.totalLikes+=(a6.isLiked?1:-1);var bd={successCallback:{fn:function a5(bk,bh){var bl=bk.json.data;if(bl){var bj=this._findRecordByParameter(bh,"nodeRef"),be=bj.getData(),bi=be.node,bf=be.likes;bf.totalLikes=bl.ratingsCount;this.widgets.dataTable.updateRow(bj,be);if(bf.isLiked){var bg={fileName:be.fileName,nodeRef:bi.nodeRef};if(bi.isContainer){this.modules.actions.postActivity(this.options.siteId,"folder-liked","folder-details",bg)}else{this.modules.actions.postActivity(this.options.siteId,"file-liked","document-details",bg)}}}},scope:this,obj:ba.toString()},failureCallback:{fn:function a7(bi,bg){var bh=this._findRecordByParameter(bg,"nodeRef"),be=bh.getData(),bf=be.likes;bf.isLiked=!bf.isLiked;bf.totalLikes+=(bf.isLiked?1:-1);this.widgets.dataTable.updateRow(bh,be);Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.save.failure",be.displayName)})},scope:this,obj:ba.toString()}};if(a6.isLiked){this.services.likes.set(ba,1,bd)}else{this.services.likes.remove(ba,bd)}this.widgets.dataTable.updateRow(bc,a9)},onFavourite:function aB(bb){var a8=bb;if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){a8=this.viewRenderers[this.options.viewRendererName].getDataTableRecordIdFromRowElement(this,bb)}var bc=this.widgets.dataTable.getRecord(a8),a9=bc.getData(),a7=a9.node,ba=a7.nodeRef;a9.isFavourite=!a9.isFavourite;this.widgets.dataTable.updateRow(bc,a9);var a6=a9.isFavourite?"favouriteDocumentOrFolder":"unFavouriteDocumentOrFolder";var bd={failureCallback:{fn:function a5(bi,be){var bh=this.widgets.dataTable.getRecord(be),bf=bh.getData(),bg=bf.node;bf.isFavourite=!bf.isFavourite;this.widgets.dataTable.updateRow(bh,bf);Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.save.failure",bf.displayName)})},scope:this,obj:bb}};this.services.preferences[a6].call(this.services.preferences,a7,bd)},onResizerChanged:function aR(){this._resizeRowContainers()},_resizeRowContainers:function ao(a8){if(!YAHOO.lang.isNumber(a8)){var a5=B.get("alf-filters"),a9=(a5?parseInt(a5.style.width,10):160)+390,a8=(B.getViewportWidth()-a9)+"px"}else{a8=(a8-390)+"px"}var a6=YAHOO.util.Selector.query("h3.filename",this.id+"-documents");for(var a7=0;a7<a6.length;a7++){a6[a7].parentNode.style.width=a8}},_setDefaultDataTableErrors:function e(a5){var a6=Alfresco.util.message;a5.set("MSG_EMPTY",a6("message.empty","Alfresco.DocumentList"));a5.set("MSG_ERROR",a6("message.error","Alfresco.DocumentList"))},_updateDefaultViewOptions:function az(ba){var a8=B.getElementsByClassName("removeDefaultView");var a9=null;if(a8.length>0){a9=a8[0].parentNode.parentNode}var a5=B.getElementsByClassName("setDefaultView");var a7=null;if(a5.length>0){a7=a5[0].parentNode.parentNode}if(this.options.userIsSiteManager||(this.doclistMetadata.parent.properties!=null&&this.doclistMetadata.parent.properties["cm:creator"].userName==Alfresco.constants.USERNAME)){if(this.doclistMetadata.parent.properties!=null&&this.doclistMetadata.parent.properties["app:defaultViewId"]!=null&&this.doclistMetadata.parent.properties["app:defaultViewId"]!=""){for(var a6=0;a6<this.options.viewRenderers.length;a6++){if(this.options.viewRenderers[a6].id==this.doclistMetadata.parent.properties["app:defaultViewId"]){a8[0].innerHTML=this.msg("button.removeDefaultView",this.options.viewRenderers[a6].label);break}}B.removeClass(a9,"hidden");if(this.doclistMetadata.parent.properties["app:defaultViewId"]==this.options.viewRendererName){B.addClass(a7,"hidden")}else{B.removeClass(a7,"hidden")}}else{B.removeClass(a7,"hidden");B.addClass(a9,"hidden")}}else{B.addClass(a7,"hidden");B.addClass(a9,"hidden")}if(ba){if(this.doclistMetadata.parent.properties&&this.doclistMetadata.parent.properties["app:defaultViewId"]!=null&&this.doclistMetadata.parent.properties["app:defaultViewId"]!=""){this.options.viewRendererName=this.doclistMetadata.parent.properties["app:defaultViewId"];B.addClass(a7,"hidden")}else{if(this.userPreferredView!=this.options.viewRendererName){this.options.viewRendererName=this.userPreferredView}}}for(var a6=0;a6<this.options.viewRenderers.length;a6++){if(this.options.viewRenderers[a6].id==this.options.viewRendererName){a5[0].innerHTML=this.msg("button.setDefaultView",this.options.viewRenderers[a6].label);break}}},_updateDocList:function aK(bi){bi=bi||{};Alfresco.logger.debug("DL__updateDocList: ",bi.filter,bi.page);var bk=YAHOO.lang.merge({doclistFirstTimeNav:false},bi.filter!==undefined?bi.filter:this.currentFilter),a6=bi.page!==undefined?bi.page:this.currentPage,be=null,ba=null,bg=this,a8={filter:bk,page:a6};var bb=function bf(){Alfresco.logger.debug("DL__uDL_fnShowLoadingMessage: slow data webscript detected.");if(ba){be=Alfresco.util.PopupManager.displayMessage({displayTime:0,text:'<span class="wait">'+f(this.msg("message.loading"))+"</span>",noEscape:true});if(YAHOO.env.ua.ie>0){this.loadingMessageShowing=true}else{be.showEvent.subscribe(function(){this.loadingMessageShowing=true},this,true)}}};this._setDefaultDataTableErrors(this.widgets.dataTable);this.previewTooltips=[];this.insituEditors=[];this.hideMoreActionsFn=null;this.loadingMessageShowing=false;ba=YAHOO.lang.later(this.options.loadingMessageDelay,this,bb);var bj=function bc(){if(ba){ba.cancel();ba=null}if(be){if(this.loadingMessageShowing){be.destroy();be=null}else{YAHOO.lang.later(100,bg,bj)}}};var bd=function a7(bo,bq,br){bj();var bl=function bm(){YAHOO.Bubbling.fire("activateDynamicControls");YAHOO.Bubbling.fire("selectedFilesChanged");this.listUpdated=false;if(this.currentFilter.filterId=="recentlyModified"||this.currentFilter.filterId=="recentlyAdded"){YAHOO.Bubbling.fire("deactivateSortControls")}else{YAHOO.Bubbling.fire("activateSortControls")}};this.afterDocListUpdate.push(bl);Alfresco.logger.debug("currentFilter was:",this.currentFilter,"now:",bk);Alfresco.logger.debug("currentPage was ["+this.currentPage+"] now ["+a6+"]");this.currentFilter=bk;this.currentPage=a6;var bs=false;if(bk.filterId==="path"){Alfresco.logger.debug("currentPath was ["+this.currentPath+"] now ["+bk.filterData+"]");bs=(this.currentPath!=bk.filterData);this.currentPath=bk.filterData}delete bk.doclistFirstTimeNav;YAHOO.Bubbling.fire("filterChanged",bk);this._updateDefaultViewOptions(bs);for(var bn=0,bp=this.options.viewRendererNames.length;bn<bp;bn++){if(typeof this.viewRenderers[this.options.viewRendererNames[bn]]==="object"){this.viewRenderers[this.options.viewRendererNames[bn]].destroyView(this,bo,bq,br)}}if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){this.viewRenderers[this.options.viewRendererName].renderView(this,bo,bq,br)}else{}};var a5=function a9(bl,bm){bj();this.afterDocListUpdate=[];if(bm.status===401){window.location.reload(true)}else{try{if(bm.status===404){YAHOO.Bubbling.fire("deactivateDynamicControls");YAHOO.Bubbling.fire("deactivateSortControls")}else{YAHOO.Bubbling.fire("deactivateAllControls")}var bp=function bn(bs,br){return function bq(){this.widgets.paginator.setState({totalRecords:0});this.widgets.paginator.render();this.widgets.dataTable.set("MSG_ERROR",bs);if(br===410){this.widgets.dataTable.showTableMessage(bs,YAHOO.widget.DataTable.CLASS_DISABLED)}else{this.widgets.dataTable.showTableMessage(bs,YAHOO.widget.DataTable.CLASS_ERROR)}}};this.afterDocListUpdate.push(bp(YAHOO.lang.JSON.parse(bm.responseText).message,bm.status));this.widgets.dataTable.initializeTable();this.widgets.dataTable.render();this.listUpdated=false}catch(bo){Alfresco.logger.error(bo);this._setDefaultDataTableErrors(this.widgets.dataTable)}}};if(a8.filter&&a8.filter.filterId==="path"){a8.path=a8.filter.filterData;if(this.currentFilter.filterData!=a8.path){Alfresco.logger.debug("currentFilter.filterData was ["+this.currentFilter.filterData+"] now ["+a8.path+"]");this.currentFilter.filterData=a8.path}}var bh=this._buildDocListParams(a8);Alfresco.logger.debug("DataSource requestParams: ",bh);this.widgets.dataSource.sendRequest(bh,{success:bd,failure:a5,scope:this})},_buildDocListParams:function a(ba){var a7=G(this.options.siteId),a8={path:this.currentPath,type:this.options.showFolders?"all":"documents",site:this.options.siteId,container:this.options.containerId,filter:this.currentFilter};if(this.options.usePagination){a8.page=this.widgets.paginator.getCurrentPage()||this.currentPage;a8.pageSize=this.widgets.paginator.getRowsPerPage()}if(typeof ba==="object"){a8=YAHOO.lang.merge(a8,ba)}var a6=("alfresco://company/shared"==this.options.rootNode);var a5=a7?"site/{site}/{container}":a6?"node/alfresco/company/shared":"node/alfresco/user/home",a9=YAHOO.lang.substitute("{type}/"+a5+(a8.filter.filterId==="path"?"{path}":""),{type:encodeURIComponent(a8.type),site:encodeURIComponent(a8.site),container:encodeURIComponent(a8.container),path:aL("/",Alfresco.util.encodeURIPath(a8.path))});a9+="?filter="+encodeURIComponent(a8.filter.filterId);if(a8.filter.filterData&&a8.filter.filterId!=="path"){a9+="&filterData="+encodeURIComponent(a8.filter.filterData)}if(this.options.usePagination){a9+="&size="+a8.pageSize+"&pos="+a8.page}a9+="&sortAsc="+this.options.sortAscending+"&sortField="+encodeURIComponent(this.options.sortField);if(!a7){a9+="&libraryRoot="+encodeURIComponent(this.options.rootNode.toString())}a9+="&view="+this.actionsView+"&noCache="+new Date().getTime();return a9},_findRecordByParameter:function aN(bb,ba){var a9=this.widgets.dataTable.getRecordSet(),a8,a5,a7,a6;for(a7=0,a6=a9.getLength();a7<a6;a7++){a8=a9.getRecord(a7);a5=a8.getData();if(a5[ba]===bb||(a5.node&&a5.node[ba]===bb)){return a8}}return null}},true)})();