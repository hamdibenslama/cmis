(function(){Alfresco.RichTextControl=function(f,g){var e=(typeof g=="undefined"||g===null)?"Alfresco.RichTextControl":g;return Alfresco.RichTextControl.superclass.constructor.call(this,e,f,["button"])};YAHOO.extend(Alfresco.RichTextControl,Alfresco.component.Base,{options:{currentValue:"",disabled:false,mandatory:false,editorParameters:null},editor:null,onReady:function b(){if(Alfresco.logger.isDebugEnabled()){Alfresco.logger.debug("Rendering rich text control for element '"+this.id+"', value = '"+this.options.currentValue+"'");Alfresco.logger.debug("Editor parameters for element '"+this.id+"': "+YAHOO.lang.dump(this.options.editorParameters))}if(!this.options.disabled){this._renderEditor()}},_renderEditor:function d(){this._renderTinyMCEEditor()},_renderTinyMCEEditor:function c(){this.editor=new Alfresco.util.RichEditor("tinyMCE",this.id,this.options.editorParameters);if(!this.options.currentValue||this.options.currentValue.indexOf("mimetype=text/html")!==-1){this.editor.getEditor().settings.forced_root_block="p"}this.editor.render();var e=this;this.editor.getEditor().on("BeforeSetContent",function(f){e._handleContentChange()});YAHOO.Bubbling.on("formBeforeSubmit",this._handleContentChange,this);if(this.id.indexOf("_prop_cm_")>0&&this.id.indexOf("_prop_cm_content")==-1){this.editor.getEditor().on("SaveContent",function(g){g.format="text";var f=tinyMCE.activeEditor.getBody().textContent;if(f==undefined){f=tinyMCE.activeEditor.getBody().innerText}g.content=f})}},_handleContentChange:function a(){if(this.editor.isDirty()){this.editor.save();if(this.options.mandatory){YAHOO.Bubbling.fire("mandatoryControlValueUpdated",this)}}}})})();